
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GeeClock - Timer App</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Roboto+Mono:wght@400&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              mono: ['Roboto Mono', 'monospace'],
            },
            colors: {
              'primary': 'rgb(var(--color-primary) / <alpha-value>)',
              'secondary': 'rgb(var(--color-secondary) / <alpha-value>)',
              'background': 'rgb(var(--color-background) / <alpha-value>)',
              'surface': 'rgb(var(--color-surface) / <alpha-value>)',
              'text-primary': 'rgb(var(--color-text-primary) / <alpha-value>)',
              'text-secondary': 'rgb(var(--color-text-secondary) / <alpha-value>)',
            },
            animation: {
                'fade-in': 'fadeIn 0.3s ease-out forwards',
            },
            keyframes: {
                fadeIn: {
                    '0%': { opacity: 0, transform: 'translateY(10px)' },
                    '100%': { opacity: 1, transform: 'translateY(0)' },
                },
            },
          }
        }
      }
    </script>
    
    <!-- CSS Variables for Theming -->
    <style>
      :root {
        --color-primary: 79 70 229;
        --color-secondary: 16 185 129;
        --color-background: 17 24 39;
        --color-surface: 31 41 55;
        --color-text-primary: 249 250 251;
        --color-text-secondary: 156 163 175;
      }
    </style>

    <!-- Babel for in-browser JSX/TS transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Import Map for CDN dependencies -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "@google/genai": "https://esm.sh/@google/genai",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "vite": "https://aistudiocdn.com/vite@^7.1.11",
    "@vitejs/plugin-react": "https://aistudiocdn.com/@vitejs/plugin-react@^5.0.4"
  }
}
</script>
</head>
<body class="bg-background text-text-primary font-sans">
    <div id="root"></div>

    <!-- The Entire React Application -->
    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useRef, useCallback } from 'react';
      import ReactDOM from 'react-dom/client';
      import { GoogleGenAI } from '@google/genai';

      // --- services/geminiService.js ---
      const apiKey = process.env.API_KEY;
      if (!apiKey) {
        console.warn("API_KEY environment variable not set. AI features will not work.");
      }
      const ai = new GoogleGenAI({ apiKey });

      // --- components/Icon.jsx ---
      const Icon = ({ name, className = 'w-6 h-6' }) => {
        const icons = {
          settings: ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.438.995s.145.755.438.995l1.003.827c.48.398.668 1.03.26 1.431l-1.296 2.247a1.125 1.125 0 0 1-1.37.49l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.063-.374-.313-.686-.645-.87a6.52 6.52 0 0 1-.22-.127c-.324-.196-.72-.257-1.075-.124l-1.217.456a1.125 1.125 0 0 1-1.37-.49l-1.296-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.437-.995s-.145-.755-.437-.995l-1.004-.827a1.125 1.125 0 0 1-.26-1.431l1.296-2.247a1.125 1.125 0 0 1 1.37-.49l1.217.456c.355.133.75.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" /><path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" /></svg>),
          close: ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18 18 6M6 6l12 12" /></svg>),
          send: ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" /></svg>),
          sparkles: ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>),
          save: ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375" /></svg>),
          reset: ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 11.667 0l3.181-3.183m-11.667-11.667a8.25 8.25 0 0 1 11.667 0l3.181 3.183m-11.667 0-3.181-3.183" /></svg>),
          robot: ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 0 0 2.25-2.25V8.25a2.25 2.25 0 0 0-2.25-2.25H6.75A2.25 2.25 0 0 0 4.5 8.25v8.25a2.25 2.25 0 0 0 2.25 2.25Zm.75-12h9v9h-9v-9Z" /></svg>),
          trash: ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.033-2.134H8.718c-1.123 0-2.033.954-2.033 2.134v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" /></svg>),
          play: ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347c.75.411.75 1.559 0 1.97l-11.54 6.347c-.75.412-1.667-.13-1.667-.986V5.653Z" /></svg>),
          pause: ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M15.75 5.25v13.5m-7.5-13.5v13.5" /></svg>),
          plus: ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>),
          clock: ( <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>)
        };
        return <div className={className}>{icons[name]}</div>;
      };

      // --- components/Clock.jsx ---
      const Clock = () => {
        const [time, setTime] = useState(new Date());
        useEffect(() => {
          const timerId = setInterval(() => setTime(new Date()), 1000);
          return () => clearInterval(timerId);
        }, []);
        const formattedTime = time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true });
        const formattedDate = time.toLocaleDateString([], { weekday: 'short', month: 'short', day: 'numeric' });
        const timeZone = time.toLocaleTimeString('en-us', {timeZoneName:'short'}).split(' ')[2];
        return (
          <div className="text-right hidden sm:block font-mono" aria-live="polite" aria-atomic="true" aria-label={`The current time is ${formattedTime}`}>
            <div className="text-lg text-text-primary">{formattedTime}</div>
            <div className="text-xs text-text-secondary">{`${formattedDate} | ${timeZone}`}</div>
          </div>
        );
      };

      // --- components/Header.jsx ---
      const Header = ({ onOpenSettings }) => {
        return (
          <header className="bg-surface/50 backdrop-blur-sm p-4 border-b border-gray-700 fixed top-0 left-0 right-0 z-10">
            <div className="container mx-auto flex justify-between items-center">
              <div className="flex items-center gap-2">
                  <Icon name="clock" className="w-6 h-6 text-secondary"/>
                  <h1 className="text-xl font-bold text-text-primary">GeeClock</h1>
              </div>
              <Clock />
              <button onClick={onOpenSettings} className="p-2 rounded-full hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-primary" aria-label="Open settings">
                <Icon name="settings" className="w-6 h-6 text-text-secondary" />
              </button>
            </div>
          </header>
        );
      };

      // --- components/AddTimerModal.jsx ---
      const AddTimerModal = ({ isOpen, onClose, onAddTimer }) => {
        const [hours, setHours] = useState('');
        const [minutes, setMinutes] = useState('');
        const [seconds, setSeconds] = useState('');
        const firstInputRef = useRef(null);
        useEffect(() => {
          if (isOpen) {
            setHours(''); setMinutes(''); setSeconds('');
            setTimeout(() => firstInputRef.current?.focus(), 100);
          }
        }, [isOpen]);
        if (!isOpen) return null;
        const handleSubmit = (e) => {
          e.preventDefault();
          const totalSeconds = (parseInt(hours) || 0) * 3600 + (parseInt(minutes) || 0) * 60 + (parseInt(seconds) || 0);
          if (totalSeconds > 0) {
            onAddTimer(totalSeconds);
            onClose();
          } else {
            alert("Please enter a valid duration.");
          }
        };
        const handleInputChange = (value, setter, max) => {
          const num = parseInt(value);
          if (value === '' || (!isNaN(num) && num >= 0 && num <= max)) {
            setter(value);
          }
        };
        return (
          <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in" onClick={onClose}>
            <div className="bg-surface rounded-lg shadow-2xl w-full max-w-sm border border-gray-700" onClick={(e) => e.stopPropagation()}>
              <div className="p-6 border-b border-gray-700 flex justify-between items-center">
                <h2 className="text-xl font-bold text-text-primary">Add New Timer</h2>
                <button onClick={onClose} className="p-1 rounded-full text-text-secondary hover:bg-gray-600"><Icon name="close" className="w-6 h-6" /></button>
              </div>
              <form onSubmit={handleSubmit} className="p-6 space-y-4">
                <div className="flex justify-center items-center gap-2 font-mono text-4xl">
                  <input ref={firstInputRef} type="number" value={hours} onChange={(e) => handleInputChange(e.target.value, setHours, 99)} placeholder="00" className="w-24 bg-gray-800 text-center rounded-md p-2 focus:ring-2 focus:ring-primary outline-none" aria-label="Hours"/>
                  <span>:</span>
                  <input type="number" value={minutes} onChange={(e) => handleInputChange(e.target.value, setMinutes, 59)} placeholder="00" className="w-24 bg-gray-800 text-center rounded-md p-2 focus:ring-2 focus:ring-primary outline-none" aria-label="Minutes"/>
                  <span>:</span>
                  <input type="number" value={seconds} onChange={(e) => handleInputChange(e.target.value, setSeconds, 59)} placeholder="00" className="w-24 bg-gray-800 text-center rounded-md p-2 focus:ring-2 focus:ring-primary outline-none" aria-label="Seconds"/>
                </div>
                <button type="submit" className="w-full mt-4 flex items-center justify-center gap-2 px-4 py-3 bg-primary text-white font-semibold rounded-md hover:bg-primary/80 transition-colors disabled:bg-gray-600">
                  <Icon name="plus" className="w-5 h-5"/> Start Timer
                </button>
              </form>
            </div>
          </div>
        );
      };

      // --- components/GeeApps.jsx ---
      const GEE_APPS_PERSONALITY_KEY = 'geeAppsPersonality';
      const GeeApps = () => {
          const [systemInstruction, setSystemInstruction] = useState('');
          const [messages, setMessages] = useState([]);
          const [input, setInput] = useState('');
          const [isLoading, setIsLoading] = useState(false);
          const [error, setError] = useState(null);
          const chatRef = useRef(null);
          const messagesEndRef = useRef(null);
          useEffect(() => {
              const savedPersonality = localStorage.getItem(GEE_APPS_PERSONALITY_KEY);
              if (savedPersonality) { setSystemInstruction(savedPersonality); }
          }, []);
          useEffect(() => {
              messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
          }, [messages]);
          const initializeChat = useCallback(() => {
              try {
                  if (!apiKey) { throw new Error("API key is not available."); }
                  chatRef.current = ai.chats.create({ model: 'gemini-2.5-flash', config: { systemInstruction: systemInstruction || "You are a helpful assistant." } });
                  setError(null);
              } catch (e) {
                  console.error("Failed to initialize chat:", e);
                  setError("Failed to initialize chat session. Please check your API key and configuration.");
              }
          }, [systemInstruction]);
          const handleSendMessage = async (e) => {
              e.preventDefault();
              if (!input.trim() || isLoading) return;
              const userMessage = { sender: 'user', text: input };
              setMessages(prev => [...prev, userMessage]);
              setInput('');
              setIsLoading(true);
              setError(null);
              try {
                  if (!chatRef.current) { initializeChat(); }
                  if (!chatRef.current) { throw new Error("Chat session not initialized."); }
                  const response = await chatRef.current.sendMessage({ message: input });
                  const aiMessage = { sender: 'ai', text: response.text };
                  setMessages(prev => [...prev, aiMessage]);
              } catch (err) {
                  console.error(err);
                  const errorMessage = err instanceof Error ? err.message : 'An unknown error occurred.';
                  setError(`Failed to get response: ${errorMessage}`);
                  setMessages(prev => prev.slice(0, -1)); 
              } finally {
                  setIsLoading(false);
              }
          };
          const handleSavePersonality = () => {
              localStorage.setItem(GEE_APPS_PERSONALITY_KEY, systemInstruction);
              chatRef.current = null;
              setMessages([]);
              alert('Personality saved! The next conversation will use the new instructions.');
          };
          const handleReset = () => {
              if(window.confirm('Are you sure you want to reset the personality and clear the chat?')) {
                  setSystemInstruction('');
                  localStorage.removeItem(GEE_APPS_PERSONALITY_KEY);
                  chatRef.current = null;
                  setMessages([]);
                  setError(null);
              }
          };
          return (
              <div className="bg-gray-900 border border-primary/50 rounded-lg p-4 mt-4 animate-fade-in">
                  <div className="flex items-center gap-3 mb-4">
                      <Icon name="robot" className="w-8 h-8 text-secondary"/>
                      <h3 className="text-xl font-bold text-secondary">GeeApps: Trainable AI Core</h3>
                  </div>
                  <div>
                      <label htmlFor="personality" className="block text-sm font-medium text-text-secondary mb-2">AI Personality (System Instruction)</label>
                      <textarea id="personality" rows={4} value={systemInstruction} onChange={(e) => setSystemInstruction(e.target.value)} className="w-full bg-gray-800 border border-gray-600 rounded-md p-2 text-text-primary focus:ring-2 focus:ring-secondary focus:border-secondary transition" placeholder="e.g., You are a pirate captain..."></textarea>
                      <div className="flex gap-2 mt-2">
                           <button onClick={handleSavePersonality} className="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2 bg-secondary text-background font-semibold rounded-md hover:bg-secondary/80 transition-colors"><Icon name="save" className="w-5 h-5"/> Save Personality</button>
                           <button onClick={handleReset} className="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2 bg-red-600 text-white font-semibold rounded-md hover:bg-red-700 transition-colors"><Icon name="reset" className="w-5 h-5"/> Reset</button>
                      </div>
                  </div>
                  <div className="mt-4 border-t border-gray-700 pt-4">
                      <div className="h-64 bg-gray-800 rounded-md p-2 overflow-y-auto flex flex-col gap-2">
                          {messages.map((msg, index) => (
                              <div key={index} className={`flex items-start gap-2 ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                                  <div className={`max-w-xs md:max-w-md lg:max-w-lg rounded-lg px-3 py-2 ${msg.sender === 'user' ? 'bg-primary text-white' : 'bg-surface text-text-primary'}`}>
                                      <p className="text-sm whitespace-pre-wrap">{msg.text}</p>
                                  </div>
                              </div>
                          ))}
                          {isLoading && (<div className="flex justify-start"><div className="bg-surface text-text-primary rounded-lg px-3 py-2"><div className="flex items-center gap-2"><div className="w-2 h-2 bg-text-secondary rounded-full animate-pulse delay-75"></div><div className="w-2 h-2 bg-text-secondary rounded-full animate-pulse delay-150"></div><div className="w-2 h-2 bg-text-secondary rounded-full animate-pulse delay-300"></div></div></div></div>)}
                          {error && <p className="text-red-400 text-sm p-2">{error}</p>}
                          <div ref={messagesEndRef} />
                      </div>
                      <form onSubmit={handleSendMessage} className="mt-2 flex items-center gap-2">
                          <input type="text" value={input} onChange={(e) => setInput(e.target.value)} placeholder="Chat with your AI..." className="flex-grow bg-surface border border-gray-600 rounded-md p-2 text-text-primary focus:ring-2 focus:ring-primary focus:border-primary transition" disabled={isLoading} />
                          <button type="submit" disabled={isLoading || !input.trim()} className="p-2 bg-primary text-white rounded-md hover:bg-primary/80 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors"><Icon name="send" className="w-5 h-5"/></button>
                      </form>
                  </div>
              </div>
          );
      };
      
      // --- components/SettingsModal.jsx ---
      const SECRET_CLICK_COUNT = 5;
      const themeOptions = [
          { name: 'default', bg: 'bg-indigo-500', label: 'Default Dark' }, { name: 'ocean', bg: 'bg-blue-500', label: 'Ocean' },
          { name: 'sunset', bg: 'bg-orange-500', label: 'Sunset' }, { name: 'forest', bg: 'bg-green-500', label: 'Forest' },
      ];
      const sizeOptions = [ { name: 'sm', label: 'S' }, { name: 'md', label: 'M' }, { name: 'lg', label: 'L' }];
      const SettingsModal = ({ isOpen, onClose, currentTheme, onThemeChange, currentSize, onSizeChange }) => {
        const [titleClickCount, setTitleClickCount] = useState(0);
        const [showSecretFeature, setShowSecretFeature] = useState(false);
        if (!isOpen) return null;
        const handleTitleClick = () => {
          if (showSecretFeature) return;
          const newCount = titleClickCount + 1;
          setTitleClickCount(newCount);
          if (newCount >= SECRET_CLICK_COUNT) { setShowSecretFeature(true); }
        };
        const handleClose = () => { setTitleClickCount(0); onClose(); };
        return (
          <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4" onClick={handleClose}>
            <div className="bg-surface rounded-lg shadow-2xl w-full max-w-2xl border border-gray-700 max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
              <div className="p-6 border-b border-gray-700 flex justify-between items-center sticky top-0 bg-surface/80">
                <h2 className="text-2xl font-bold text-text-primary select-none" onClick={handleTitleClick}>Settings</h2>
                <button onClick={handleClose} className="p-1 rounded-full text-text-secondary hover:bg-gray-600"><Icon name="close" className="w-6 h-6" /></button>
              </div>
              <div className="p-6 space-y-8">
                <div className="space-y-4">
                  <h3 className="text-lg font-semibold text-text-primary">Appearance</h3>
                  <div>
                    <label className="block text-text-secondary mb-2">Theme</label>
                    <div className="flex flex-wrap gap-4">
                      {themeOptions.map(theme => (<button key={theme.name} onClick={() => onThemeChange(theme.name)} className="flex items-center gap-2 text-left"><div className={`w-6 h-6 rounded-full ${theme.bg} border-2 ${currentTheme === theme.name ? 'border-white' : 'border-transparent'}`}></div><span className={currentTheme === theme.name ? 'text-text-primary font-semibold' : 'text-text-secondary'}>{theme.label}</span></button>))}
                    </div>
                  </div>
                  <div>
                    <label className="block text-text-secondary mb-2">Size</label>
                    <div className="flex gap-2 bg-gray-900 p-1 rounded-md">
                      {sizeOptions.map(size => (<button key={size.name} onClick={() => onSizeChange(size.name)} className={`w-12 h-10 rounded ${currentSize === size.name ? 'bg-primary text-white font-bold' : 'hover:bg-gray-700'}`}>{size.label}</button>))}
                    </div>
                  </div>
                </div>
                <div className="space-y-4 border-t border-gray-700 pt-8">
                  <h3 className="text-lg font-semibold text-text-primary">About</h3>
                  <div className="flex justify-between items-center"><span className="text-text-secondary">App Version</span><span className="text-text-primary font-mono">1.1.0-beta</span></div>
                </div>
                {showSecretFeature && <GeeApps />}
              </div>
            </div>
          </div>
        );
      };
      
      // --- components/MainContent.jsx ---
      const formatTime = (totalSeconds) => {
        const h = Math.floor(totalSeconds / 3600);
        const m = Math.floor((totalSeconds % 3600) / 60);
        const s = totalSeconds % 60;
        return [h, m, s].map(v => v.toString().padStart(2, '0')).join(':');
      };
      const Timer = ({ timerInfo, onDelete, size, alarmAudioRef }) => {
        const [remainingTime, setRemainingTime] = useState(timerInfo.initialDuration);
        const [isRunning, setIsRunning] = useState(true);
        const [isExpired, setIsExpired] = useState(false);
        useEffect(() => {
          let interval = null;
          if (isRunning && remainingTime > 0) {
            interval = window.setInterval(() => setRemainingTime(prev => prev - 1), 1000);
          } else if (remainingTime === 0 && isRunning) {
            setIsRunning(false);
            setIsExpired(true);
            alarmAudioRef.current?.play().catch(e => console.error("Alarm playback failed.", e));
            document.title = "Time's up!";
            setTimeout(() => { document.title = "GeeClock"; }, 5000)
          }
          return () => { if (interval) clearInterval(interval); };
        }, [isRunning, remainingTime, alarmAudioRef]);
        const handleTogglePlay = () => { if (remainingTime > 0) setIsRunning(!isRunning); };
        const handleReset = () => { setIsRunning(false); setIsExpired(false); setRemainingTime(timerInfo.initialDuration); };
        const progress = (timerInfo.initialDuration - remainingTime) / timerInfo.initialDuration * 100;
        const sizeClasses = {
          sm: { container: "p-4", time: "text-4xl", total: "text-xs", buttons: "gap-2", resetBtn: "p-2", playBtn: "p-3", playIcon: "w-6 h-6", },
          md: { container: "p-6", time: "text-5xl", total: "text-sm", buttons: "gap-4", resetBtn: "p-3", playBtn: "p-4", playIcon: "w-8 h-8", },
          lg: { container: "p-8", time: "text-6xl", total: "text-base", buttons: "gap-5", resetBtn: "p-4", playBtn: "p-5", playIcon: "w-10 h-10", }
        };
        const styles = sizeClasses[size];
        return (
          <div className={`bg-surface rounded-lg p-6 shadow-lg border border-primary/20 relative overflow-hidden ${styles.container}`}>
            <div className="absolute top-0 left-0 h-full bg-primary/20 transition-all duration-500 ease-linear" style={{ width: `${progress}%` }}></div>
            <div className="relative z-10">
              <div className="flex justify-between items-start">
                <div className="flex items-center gap-2"><Icon name="clock" className="w-5 h-5 text-secondary" /><span className="font-semibold text-text-primary">Timer</span></div>
                <button onClick={() => onDelete(timerInfo.id)} className="p-1 rounded-full text-text-secondary hover:bg-gray-700 transition-colors" aria-label="Delete timer"><Icon name="trash" className="w-5 h-5" /></button>
              </div>
              <div className="text-center my-4">
                <p className={`font-mono font-bold tracking-wider ${styles.time} ${isExpired ? 'text-red-500 animate-pulse' : 'text-text-primary'}`}>{formatTime(remainingTime)}</p>
                <p className={`text-text-secondary ${styles.total}`}>Total: {formatTime(timerInfo.initialDuration)}</p>
              </div>
              <div className={`flex justify-center ${styles.buttons}`}>
                <button onClick={handleReset} className={`rounded-full bg-gray-700 hover:bg-gray-600 transition-colors text-text-secondary ${styles.resetBtn}`} aria-label="Reset timer"><Icon name="reset" className="w-6 h-6" /></button>
                <button onClick={handleTogglePlay} className={`rounded-full bg-secondary text-background hover:bg-secondary/80 transition-colors ${styles.playBtn}`} aria-label={isRunning ? "Pause timer" : "Play timer"}><Icon name={isRunning ? 'pause' : 'play'} className={styles.playIcon} /></button>
              </div>
            </div>
          </div>
        );
      };
      const MainContent = ({ size }) => {
        const [timers, setTimers] = useState([]);
        const [isAddModalOpen, setIsAddModalOpen] = useState(false);
        const alarmAudioRef = useRef(null);
        const [isAudioUnlocked, setIsAudioUnlocked] = useState(false);
        useEffect(() => {
          try {
            const savedTimers = localStorage.getItem('gee-timers');
            if (savedTimers) { setTimers(JSON.parse(savedTimers)); }
          } catch (error) { console.error("Failed to load timers", error); }
        }, []);
        useEffect(() => {
          try { localStorage.setItem('gee-timers', JSON.stringify(timers)); } 
          catch (error) { console.error("Failed to save timers", error); }
        }, [timers]);
        const handleAddTimer = (durationInSeconds) => {
          if (!isAudioUnlocked && alarmAudioRef.current) {
            const promise = alarmAudioRef.current.play();
            if (promise !== undefined) {
              promise.then(() => {
                alarmAudioRef.current?.pause();
                if (alarmAudioRef.current) alarmAudioRef.current.currentTime = 0;
                setIsAudioUnlocked(true);
              }).catch(error => { console.error("Audio could not be unlocked:", error); });
            }
          }
          const newTimer = { id: Date.now(), initialDuration: durationInSeconds };
          setTimers(prev => [...prev, newTimer]);
        };
        const handleDeleteTimer = (id) => setTimers(prev => prev.filter(timer => timer.id !== id));
        const sizeClasses = {
          sm: { minHeight: "min-h-[220px]" },
          md: { minHeight: "min-h-[250px]" },
          lg: { minHeight: "min-h-[280px]" }
        };
        const styles = sizeClasses[size];
        return (
          <main className="container mx-auto px-4 py-24">
            <audio ref={alarmAudioRef} src="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABDb252ZXJ0ZWQgd2l0aCBvbmxpbmVhdWRpb2NvbnZlcnRlci5jb20ALAAAAA//uQ4AAnYwADU3NjU0MzIxMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA-"></audio>
            <div className={`grid gap-4 md:gap-6 ${timers.length > 0 ? 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4' : ''}`}>
              {timers.map(timerInfo => (
                <div key={timerInfo.id} className={styles.minHeight}>
                  <Timer timerInfo={timerInfo} onDelete={handleDeleteTimer} size={size} alarmAudioRef={alarmAudioRef} />
                </div>
              ))}
              <div className={styles.minHeight}>
                <button onClick={() => setIsAddModalOpen(true)} className="w-full h-full border-2 border-dashed border-gray-600 rounded-lg flex flex-col items-center justify-center text-gray-400 hover:bg-surface hover:border-primary transition-colors">
                  <Icon name="plus" className="w-12 h-12 mb-2" />
                  <span className="font-semibold">Add Timer</span>
                </button>
              </div>
            </div>
            <AddTimerModal isOpen={isAddModalOpen} onClose={() => setIsAddModalOpen(false)} onAddTimer={handleAddTimer} />
          </main>
        );
      };

      // --- App.jsx (The Root Component) ---
      const themes = {
        default: { primary: '79 70 229', secondary: '16 185 129', background: '17 24 39', surface: '31 41 55', 'text-primary': '249 250 251', 'text-secondary': '156 163 175' },
        ocean: { primary: '59 130 246', secondary: '52 211 153', background: '15 23 42', surface: '30 41 59', 'text-primary': '241 245 249', 'text-secondary': '148 163 184' },
        sunset: { primary: '249 115 22', secondary: '239 68 68', background: '28 25 23', surface: '41 37 36', 'text-primary': '250 250 249', 'text-secondary': '168 162 158' },
        forest: { primary: '34 197 94', secondary: '202 138 4', background: '20 30 20', surface: '30 46 30', 'text-primary': '220 252 231', 'text-secondary': '163 230 170' },
      };
      const App = () => {
        const [isSettingsOpen, setIsSettingsOpen] = useState(false);
        const [theme, setTheme] = useState('default');
        const [size, setSize] = useState('md');
        useEffect(() => {
          const savedTheme = localStorage.getItem('gee-theme');
          if (savedTheme && savedTheme in themes) setTheme(savedTheme);
          const savedSize = localStorage.getItem('gee-size');
          if (savedSize && ['sm', 'md', 'lg'].includes(savedSize)) setSize(savedSize);
        }, []);
        useEffect(() => {
          const root = document.documentElement;
          const themeColors = themes[theme];
          Object.entries(themeColors).forEach(([key, value]) => root.style.setProperty(`--color-${key}`, value));
          localStorage.setItem('gee-theme', theme);
        }, [theme]);
        useEffect(() => {
          localStorage.setItem('gee-size', size);
        }, [size]);
        return (
          <div className="min-h-screen">
            <Header onOpenSettings={() => setIsSettingsOpen(true)} />
            <MainContent size={size} />
            <SettingsModal 
              isOpen={isSettingsOpen} 
              onClose={() => setIsSettingsOpen(false)}
              currentTheme={theme}
              onThemeChange={setTheme}
              currentSize={size}
              onSizeChange={setSize}
            />
          </div>
        );
      };
      
      // --- index.js (Entry Point) ---
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }
      const root = ReactDOM.createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
</body>
</html>
